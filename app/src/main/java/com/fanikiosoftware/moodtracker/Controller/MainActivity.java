package com.fanikiosoftware.moodtracker.Controller;import android.annotation.SuppressLint;import android.app.AlertDialog;import android.content.Intent;import android.content.SharedPreferences;import android.graphics.Color;import android.os.Bundle;import android.preference.PreferenceManager;import android.util.Log;import android.view.GestureDetector;import android.view.LayoutInflater;import android.view.MotionEvent;import android.view.View;import android.view.View.OnTouchListener;import android.widget.Button;import android.widget.EditText;import android.widget.ImageButton;import android.widget.ImageView;import android.widget.Toast;import android.media.MediaPlayer;import com.fanikiosoftware.moodtracker.R;import com.fanikiosoftware.moodtracker.Utility.Constants;import com.fanikiosoftware.moodtracker.Utility.MyCalendarClass;import androidx.appcompat.app.AppCompatActivity;import static java.lang.System.out;public class MainActivity extends AppCompatActivity implements OnTouchListener,        GestureDetector.OnGestureListener {    public static final int SWIPE_THRESHOLD = 100;    public static final int SWIPE_VELOCITY_THRESHOLD = 100;    private static final String TAG = "MainActivity";    private ImageView ivMood;    private EditText editText;    private Button btnCancel, btnConfirm;    private View view;    private SharedPreferences mPreferences;    private GestureDetector mGestureDetector;    public static int selectedMoodId = Constants.MOOD_GREAT;    private MediaPlayer mediaPlayer;    @Override    protected void onCreate(final Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        view = this.getWindow().getDecorView();        mPreferences = PreferenceManager.getDefaultSharedPreferences(this);        checkMood();        MyCalendarClass.setAlarm(this);        Log.d(TAG, ":: MyCalendarClass called");        ImageButton addButton = findViewById(R.id.btnAdd);        ImageButton historyButton = findViewById(R.id.btnHistory);        //set up listeners        mGestureDetector = new GestureDetector(this);        addButton.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View v) {                final AlertDialog dialogBuilder =                        new AlertDialog.Builder(MainActivity.this).create();                LayoutInflater inflater = MainActivity.this.getLayoutInflater();                @SuppressLint("InflateParams") View dialogView = inflater.inflate(R.layout.popup_input_dialog, null);                editText = dialogView.findViewById(R.id.etComment);                btnConfirm = dialogView.findViewById(R.id.btnConfirm);                btnCancel = dialogView.findViewById(R.id.btnCancel);                //set up listeners                btnConfirm.setOnClickListener(new View.OnClickListener() {                    @Override                    public void onClick(View view) {                        saveMood();                        saveMemo();                        dialogBuilder.dismiss();                    }                });                btnCancel.setOnClickListener(new View.OnClickListener() {                    @Override                    public void onClick(View view) {                        dialogBuilder.dismiss();                    }                });                dialogBuilder.setView(dialogView);                dialogBuilder.show();            }        });        //history btn listener, start History Activity        historyButton.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View v) {                Intent historyActivityIntent = new Intent(MainActivity.this,                        HistoryActivity.class);                startActivity(historyActivityIntent);            }        });    }    //  if a mood has been stored, display, else, set default mood    private void checkMood() {        setContentView(R.layout.activity_main);        ivMood = findViewById(R.id.ivMood);        selectedMoodId = mPreferences.getInt(Constants.PREF_KEY_CURRENT_MOOD, 5);        if (selectedMoodId < 5) {            switch (selectedMoodId) {                case Constants.MOOD_GREAT:                    selectedMoodId = Constants.MOOD_GREAT;                    break;                case Constants.MOOD_GOOD:                    selectedMoodId = Constants.MOOD_GOOD;                    break;                case Constants.MOOD_DECENT:                    selectedMoodId = Constants.MOOD_DECENT;                    break;                case Constants.MOOD_BAD:                    selectedMoodId = Constants.MOOD_BAD;                    break;                case Constants.MOOD_SAD:                    selectedMoodId = Constants.MOOD_SAD;                    break;            }        } else {            //set default mood and color if no mood was previously saved            selectedMoodId = Constants.MOOD_GREAT;        }        view.setBackgroundColor(Color.parseColor(Constants.colorsArr[selectedMoodId]));        ivMood.setImageResource(Constants.emojiArr[selectedMoodId]);    }    //  save memo from popup input dialog when user clicks on CONFIRM    public void saveMemo() {        mPreferences.edit().putString(                Constants.PREF_KEY_CURRENT_MEMO, editText.getText().toString().trim()).apply();        Toast.makeText(this, "Your memo has been saved!", Toast.LENGTH_SHORT).show();        Log.d(TAG, "PREF_KEY_CURRENT_MEMO :: " + mPreferences.getString(Constants.PREF_KEY_CURRENT_MEMO, null));    }    //  save the mood that is currently selected    public void saveMood() {        mPreferences.edit().putInt(Constants.PREF_KEY_CURRENT_MOOD, selectedMoodId).apply();        Log.d(TAG, "PREF_KEY_CURRENT_MOOD :: " + mPreferences.getInt(Constants.PREF_KEY_CURRENT_MOOD, 5));    }    @Override    public boolean onTouchEvent(MotionEvent event) {        mGestureDetector.onTouchEvent(event);        return super.onTouchEvent(event);    }    @Override    public boolean onTouch(View v, MotionEvent event) {        v.performClick();        return false;    }    //    detect if motion event is vertical and significant enough to warrant activity in app    @Override    public boolean onFling(MotionEvent downEvent, MotionEvent moveEvent,                           float velocityX, float velocityY) {        //did event get handled here? Assume the negative        boolean result = false;        //gauge movement along y axis for determining if user swiped vertically        //subtract the starting position on the Y axis from the ending position on Y axis        float diffY = moveEvent.getY() - downEvent.getY();        //ignore all non-vertical swipe gestures        //handle vertical swipes        if (Math.abs(diffY) > SWIPE_THRESHOLD && Math.abs(velocityY) > SWIPE_VELOCITY_THRESHOLD) {            if (diffY > 0) {                onSwipeDownwards();            } else {                onSwipeUpwards();            }            //gesture was handled within this method so result changed to TRUE            result = true;        }        return result;    }    //    mood changes from bad to good as user swipes upward    private void onSwipeUpwards() {        switch (selectedMoodId) {            case Constants.MOOD_SAD:                playSound();                selectedMoodId = Constants.MOOD_BAD;                break;            case Constants.MOOD_BAD:                playSound();                selectedMoodId = Constants.MOOD_DECENT;                break;            case Constants.MOOD_DECENT:                playSound();                selectedMoodId = Constants.MOOD_GOOD;                break;            case Constants.MOOD_GOOD:                playSound();                selectedMoodId = Constants.MOOD_GREAT;                break;            case Constants.MOOD_GREAT:                //do nothing-user must swipe down to go back to lesser mood                break;        }        view.setBackgroundColor(Color.parseColor(Constants.colorsArr[selectedMoodId]));        ivMood.setImageResource(Constants.emojiArr[selectedMoodId]);    }    //  mood changes from good to bad as user swipes downward    public void onSwipeDownwards() {        switch (selectedMoodId) {            case Constants.MOOD_GREAT:                playSound();                selectedMoodId = Constants.MOOD_GOOD;                break;            case Constants.MOOD_GOOD:                playSound();                selectedMoodId = Constants.MOOD_DECENT;                break;            case Constants.MOOD_DECENT:                playSound();                selectedMoodId = Constants.MOOD_BAD;                break;            case Constants.MOOD_BAD:                playSound();                selectedMoodId = Constants.MOOD_SAD;                break;            case Constants.MOOD_SAD:                //do nothing -user must swipe up to go back to better mood                break;        }        view.setBackgroundColor(Color.parseColor(Constants.colorsArr[selectedMoodId]));        ivMood.setImageResource(Constants.emojiArr[selectedMoodId]);    }    private void playSound(){        if (mediaPlayer != null) {            mediaPlayer.reset();            mediaPlayer.release();            mediaPlayer = null;        }        mediaPlayer =  MediaPlayer.create(this, R.raw.beep);        mediaPlayer.start();    }    @Override    public boolean onDown(MotionEvent e) {        return false;    }    @Override    public void onShowPress(MotionEvent e) {    }    @Override    public boolean onSingleTapUp(MotionEvent e) {        return false;    }    @Override    public boolean onScroll(MotionEvent e1, MotionEvent e2, float distanceX, float distanceY) {        return false;    }    @Override    public void onLongPress(MotionEvent e) {    }    @Override    protected void onStart() {        super.onStart();        out.println("MainActivity::onStart()");    }    @Override    protected void onStop() {        super.onStop();        out.println("MainActivity::onStop()");    }    @Override    protected void onDestroy() {        super.onDestroy();        out.println("MainActivity::onDestroy()");    }    @Override    protected void onPause() {        super.onPause();        saveMood();//        mediaPlayer.release();//        mediaPlayer = null;        out.println("MainActivity::onPause()");    }    @Override    protected void onResume() {        super.onResume();        out.println("MainActivity::onResume()");    }}